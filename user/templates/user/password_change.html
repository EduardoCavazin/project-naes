{% extends "core/models/form_base.html" %}
{% load crispy_forms_tags %}

{% block form_title %}Alterar Senha{% endblock form_title %}
{% block form_subtitle %}
  <p class="text-muted">Digite sua senha atual e a nova senha</p>
{% endblock form_subtitle %}

{% block form_fields %}
  {{ form|crispy }}
{% endblock form_fields %}

{% block extra_content %}
<div class="text-center mt-3">
  <p><a href="{% url 'password_reset' %}" class="text-muted">Esqueci minha senha atual</a></p>
</div>
{% endblock extra_content %}

{% block form_specific_js %}
  // Validação de senhas iguais
  document.addEventListener('DOMContentLoaded', function() {
    const newPassword1 = document.getElementById('id_new_password1');
    const newPassword2 = document.getElementById('id_new_password2');
    
    if (newPassword1 && newPassword2) {
      function validatePasswords() {
        if (newPassword1.value && newPassword2.value) {
          if (newPassword1.value !== newPassword2.value) {
            newPassword2.classList.add('is-invalid');
            let feedback = newPassword2.parentNode.querySelector('.invalid-feedback');
            if (!feedback) {
              feedback = document.createElement('div');
              feedback.className = 'invalid-feedback';
              newPassword2.parentNode.appendChild(feedback);
            }
            feedback.textContent = 'As senhas não coincidem.';
          } else {
            newPassword2.classList.remove('is-invalid');
            const feedback = newPassword2.parentNode.querySelector('.invalid-feedback');
            if (feedback) {
              feedback.remove();
            }
          }
        }
      }
      
      newPassword1.addEventListener('input', validatePasswords);
      newPassword2.addEventListener('input', validatePasswords);
    }
  });
{% endblock form_specific_js %}
