{% extends "core/models/form_base.html" %}
{% load crispy_forms_tags %}

{% block form_title %}{{ titulo }}{% endblock form_title %}
{% block form_subtitle %}
  <p class="text-muted">Informe os dados do cheque</p>
{% endblock form_subtitle %}

{% block form_fields %}
  {{ form|crispy }}
{% endblock form_fields %}

{% block form_specific_js %}
  const compensationDateInput = document.getElementById('id_compensation_date');
  const statusSelect = document.getElementById('id_status');
  
  // Verifica se a data de compensação é anterior à data atual
  function checkCompensationDate() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const compensationDate = new Date(compensationDateInput.value);
    
    // Se a data de compensação é hoje ou antes, sugere mudar o status para "compensado"
    if (compensationDate <= today && statusSelect.value === 'pending') {
      if (confirm('A data de compensação é hoje ou já passou. Deseja alterar o status para "Compensado"?')) {
        statusSelect.value = 'cashed';
      }
    }
  }
  
  if (compensationDateInput && statusSelect) {
    compensationDateInput.addEventListener('change', checkCompensationDate);
    
    // Verificar também ao carregar o formulário
    checkCompensationDate();
  }
{% endblock form_specific_js %}